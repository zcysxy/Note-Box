---
alias: 作用域
---

# Python Scope

[[Python]]

---

变量的作用域 Scope
: 变量起作用的范围

Python 有四类作用域:

1. 局部 [Local](#local)
2. 封闭 [Enclosing](#enclosing)
3. 全局 [Global](#global)
4. 内置 [Built-in](#built-in)

## Local

* [[Python Statements - def|函数内部]]定义的对象, 称为局部 local 对象
* 局部变量只在该函数内起作用, 函数[[Python Statements - return|执行结束]]后自动被移除, 具有**临时性**特点
* 局部变量的引用比[全局](#global)变量速度快

## Enclosing

* [[Python Statements - def|函数定义]]外层的对象

## Global

* 最外层定义的对象,即不在任何[[Python Statements - def|函数定义]]中, 称为全局 global 对象

* 可用 [[Python Statements - global|global]] 语句在[[Python Statements - def|函数定义]]内创建或改变全局变量

## Built-in

* 内置对象
* 如内置函数 *len*

## LEGB 规则

在作用域中按名称去寻找对象时, 会按照 **LEGB 规则**去查找:

```txt
Local -> Enclosing -> Global -> Built-in
```

* 这个规则当然还是**往前查找**, 即之后定义的任何东西都不会影响前面的代码
* 这里的对象之**一切 Python 对象**
    * 比如嵌套定义的内部函数未用 [[Python Statements - global|global]] 声明为全局函数的话是无法在外面被调用的
* 若有**重名**对象, 按照 **LEGB 规则**使用找到的第一个对象
* [Enclosing](#enclosing) 又是分层的, 查找对象时会先找到 "最内层" 的对象
* 整个规则就是一个**从内到外的查找**

### Example

```python
print(len)              #1

len = (len([]))         #2
print(len)              #3

def a():
    len = 1             #4
    
    def b():
        print(len)      #5
        len = 2         #6
        print(len)      #7
        
        def c():
            print(len)  #8
        
        c()

    b()

a()
print(len)
```

1. *len* 本身是一个 [内置](#built-in)函数, 故此时打印输出为 `<built-in function len>`
2. 重新定义了**重名**[全局](#global)变量 `len = 0`
    * [[Python Keywords]] 则永远不能有其他重名对象
3. 打印输出为 `0`, 因为 [全局](#global) > [内置](#built-in)
4. 又重新定义了 `len = 1`, 此时它是[局部](#local)变量, 同时相对于函数 *b* 和 *c* 来说又是[外层](#enclosing)变量
5. 打印输出为 `1`, 因为 [外层](#enclosing) > [全局](#global)
6. 再次重新定义了 `len = 2`, 此时它是[局部](#local)变量, 同时相对于函数 *c* 来说又是[外层](#enclosing)变量
7. 之后打印输出为 `2`, 因为 [局部](#local) > [外层](#enclosing)
8. 打印输出为 `2`, 因为更内的[外层](#enclosing) > 更外的[外层](#enclosing)

## 跨作用域对象

可以用[[Python Keywords|关键字]] [[Python Statements - global|global]] 和 [[Python Statements - nonlocal|nonlocal]] 来声明跨作用域对象:

* [[Python Statements - global|global]] 将[局部](#local)对象声明为[全局](#global)对象
* [[Python Statements - nonlocal|nonlocal]] 将[局部](#local)对象声明为[外层](#enclosing)对象

## No Block Scope

Python 没有块级作用域 Block scope, 如 [[Python Loops]] 单独的作用域.

```python
for i in range(10):
    pass

print(i)
```

如上例的输出为 `9`, 即 %i% 是一个全局变量, 而非限制在 *for* 循环的 block scope 中.

!! 所以要注意区分循环变量等细节.

[//begin]: # "Autogenerated link references for markdown compatibility"
[Python]: Python "Python"
[Python Keywords]: Python Keywords "Python Keywords"
[Python Loops]: Python Loops "Python Loops"
[//end]: # "Autogenerated link references"